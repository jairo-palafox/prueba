#################################################################################
#Nombre del Programa => CARINFXV4R                                              #
#Descripción         => REVERSO RETXV49.4gl                                     #
#Fecha creacion      => 06 de Octubre del 2015                                  #
#Por                 => Luis Felipe Prieto Cano                                 #
#Requerimiento       => CARINFXV-4                                              #
#################################################################################
DATABASE safre_viv
GLOBALS
    DEFINE #DATE
        HOY                  DATE
               
    DEFINE #CHAR
        enter                CHAR(1)
END GLOBALS

MAIN
    CALL init()         --Se inicializan variables
    CALL primer_paso()  --Elimina el movimiento de restitución de la cuenta 
    CALL segundo_paso() --Deja el estado solicitud original
    CALL tercer_paso()  --Marca nuevamente las cuentas
    DISPLAY "Se ejecuto el proceso correctamente."
END MAIN

FUNCTION init()
--------------
    LET HOY = TODAY
END FUNCTION

FUNCTION primer_paso()
----------------------   
    --Se eliminan movimientos de restitución
    --No existen movimientos para esta solicitud
END FUNCTION

FUNCTION segundo_paso()
-----------------------
   --Se cambian las solicitudes a los estados/codigos de rechazo originales

   UPDATE ret_solicitud_generico
   SET    estado_solicitud = 211 ,
          cod_rechazo      = 65   
   WHERE  id_solicitud IN  (7425247,7054067,7267156,7593049,6921101,7592785,7354274,6998038,7278478,7566509,6981182,7389509,7146963,7575413,
                            7198668,5332184,7462043,7536221,7494532,7146991,7254957,7274722,7672901,7570766,7432044,7058664,7657697,7429737,
                            7579821,7579708,7433865,7686623,7495216,7676676,7464782,7691659,7678590,7566510,7427615,7658584,7399962,7151320,
                            7277088,7494466,7407603,7467929,7497732,7460185,7496608,7425260,7247576,7463310,7162199,7422980,7434092,7443757,
                            7431152,7434251,7498785,7267297,7234442,7680466,7457564,7687620,7567565,7683947,5181312,7578292,7155423,7678965,
                            7686218,7672896,7574250,7564341,7502679,7147286,7292491,7641857,7494438,7375716,7413615,7389344,7435959,7584815,
                            7294728,7536662,7388122,7122102,7392549,7657720,7656011,7205596,7354437,7466845,7464053,7289119,7247045,7390814,
                            7568486,7670917,7428688,7354512)

   UPDATE ret_solicitud_generico
   SET    estado_solicitud = 214 ,
          cod_rechazo      = 64   
   WHERE  id_solicitud IN  (7112522,7288062,5176677,7354412,7115726,7153408,7392952,5080375,7197427,5086917,7709915,5336155,7212014,7709243,
                            5320307,7398571,7150190,7680025,7684425,7650272,7148439,7662386,5291199,7222027,7721089,7668876,7156986,7214966,
                            7413493,7580472,7421611,5328053,7283464,7683910,7388298,5080764,5336726,7154687,5199258,5083683,5195365,5084029,
                            7362966)
   
   UPDATE ret_solicitud_generico
   SET    estado_solicitud = 214 ,
          cod_rechazo      = 65   
   WHERE  id_solicitud IN  (5086023,5078328,5284280,5177831,5090359)
-----------------------------------------

   UPDATE ret_amort_excedente
   SET    estado_solicitud = 211 ,
          cod_rechazo      = 65   
   WHERE  id_solicitud IN  (7425247,7054067,7267156,7593049,6921101,7592785,7354274,6998038,7278478,7566509,6981182,7389509,7146963,7575413,
                            7198668,5332184,7462043,7536221,7494532,7146991,7254957,7274722,7672901,7570766,7432044,7058664,7657697,7429737,
                            7579821,7579708,7433865,7686623,7495216,7676676,7464782,7691659,7678590,7566510,7427615,7658584,7399962,7151320,
                            7277088,7494466,7407603,7467929,7497732,7460185,7496608,7425260,7247576,7463310,7162199,7422980,7434092,7443757,
                            7431152,7434251,7498785,7267297,7234442,7680466,7457564,7687620,7567565,7683947,5181312,7578292,7155423,7678965,
                            7686218,7672896,7574250,7564341,7502679,7147286,7292491,7641857,7494438,7375716,7413615,7389344,7435959,7584815,
                            7294728,7536662,7388122,7122102,7392549,7657720,7656011,7205596,7354437,7466845,7464053,7289119,7247045,7390814,
                            7568486,7670917,7428688,7354512)

   UPDATE ret_amort_excedente
   SET    estado_solicitud = 214 ,
          cod_rechazo      = 64   
   WHERE  id_solicitud IN  (7112522,7288062,5176677,7354412,7115726,7153408,7392952,5080375,7197427,5086917,7709915,5336155,7212014,7709243,
                            5320307,7398571,7150190,7680025,7684425,7650272,7148439,7662386,5291199,7222027,7721089,7668876,7156986,7214966,
                            7413493,7580472,7421611,5328053,7283464,7683910,7388298,5080764,5336726,7154687,5199258,5083683,5195365,5084029,
                            7362966)
   
   UPDATE ret_amort_excedente
   SET    estado_solicitud = 214 ,
          cod_rechazo      = 65   
   WHERE  id_solicitud IN  (5086023,5078328,5284280,5177831,5090359)

END FUNCTION

FUNCTION tercer_paso()
#---------------------
    DELETE
    FROM   sfr_marca_activa
    WHERE  n_referencia IN (7425247,7054067,7267156,7593049,6921101,7592785,7354274,6998038,7278478,7566509,6981182,7389509,7146963,7575413,
                            7198668,5332184,7462043,7536221,7494532,7146991,7254957,7274722,7672901,7570766,7432044,7058664,7657697,7429737,
                            7579821,7579708,7433865,7686623,7495216,7676676,7464782,7691659,7678590,7566510,7427615,7658584,7399962,7151320,
                            7277088,7494466,7407603,7467929,7497732,7460185,7496608,7425260,7247576,7463310,7162199,7422980,7434092,7443757,
                            7431152,7434251,7498785,7267297,7234442,7680466,7457564,7687620,7567565,7683947,5181312,7578292,7155423,7678965,
                            7686218,7672896,7574250,7564341,7502679,7147286,7292491,7641857,7494438,7375716,7413615,7389344,7435959,7584815,
                            7294728,7536662,7388122,7122102,7392549,7657720,7656011,7205596,7354437,7466845,7464053,7289119,7247045,7390814,
                            7568486,7670917,7428688,7354512,7112522,7288062,5176677,7354412,7115726,7153408,7392952,5080375,7197427,5086917,
                            7709915,5336155,7212014,7709243,5320307,7398571,7150190,7680025,7684425,7650272,7148439,7662386,5291199,7222027,
                            7721089,7668876,7156986,7214966,7413493,7580472,7421611,5328053,7283464,7683910,7388298,5080764,5336726,7154687,
                            5199258,5083683,5195365,5084029,7362966,5086023,5078328,5284280,5177831,5090359)
    AND    marca         = 810

    
    DELETE
    FROM   sfr_marca_historica
    WHERE  n_referencia IN (7425247,7054067,7267156,7593049,6921101,7592785,7354274,6998038,7278478,7566509,6981182,7389509,7146963,7575413,
                            7198668,5332184,7462043,7536221,7494532,7146991,7254957,7274722,7672901,7570766,7432044,7058664,7657697,7429737,
                            7579821,7579708,7433865,7686623,7495216,7676676,7464782,7691659,7678590,7566510,7427615,7658584,7399962,7151320,
                            7277088,7494466,7407603,7467929,7497732,7460185,7496608,7425260,7247576,7463310,7162199,7422980,7434092,7443757,
                            7431152,7434251,7498785,7267297,7234442,7680466,7457564,7687620,7567565,7683947,5181312,7578292,7155423,7678965,
                            7686218,7672896,7574250,7564341,7502679,7147286,7292491,7641857,7494438,7375716,7413615,7389344,7435959,7584815,
                            7294728,7536662,7388122,7122102,7392549,7657720,7656011,7205596,7354437,7466845,7464053,7289119,7247045,7390814,
                            7568486,7670917,7428688,7354512,7112522,7288062,5176677,7354412,7115726,7153408,7392952,5080375,7197427,5086917,
                            7709915,5336155,7212014,7709243,5320307,7398571,7150190,7680025,7684425,7650272,7148439,7662386,5291199,7222027,
                            7721089,7668876,7156986,7214966,7413493,7580472,7421611,5328053,7283464,7683910,7388298,5080764,5336726,7154687,
                            5199258,5083683,5195365,5084029,7362966,5086023,5078328,5284280,5177831,5090359)
    AND    marca         = 810
    
    LOAD FROM "sfr_marca_activa.CARINFXV4.unl" INSERT INTO sfr_marca_activa
    LOAD FROM "sfr_marca_historica.CARINFXV4.unl" INSERT INTO sfr_marca_historica  
END FUNCTION
